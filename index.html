<!DOCTYPE html>
    <html>
        <head>
            <style>
                #torso {
                    position:absolute;
                    -webkit-user-drag: none;
                    user-select: none;
                    transform: translate(-50%, -50%);
                    z-index: -5;
                }
                #head {
                    position:absolute;
                    user-select: none;
                    -webkit-user-drag: none;
                    transform: translate(-50%, -130%);
                    z-index: -2;
                    transform-origin: center 45%;
                }
                #weapon {
                    position: absolute;
                    user-select: none;
                    -webkit-user-drag: none;
                    transform: translate(-50%, -50%);
                    z-index: -4;
                }
                body {
				    overflow: hidden;
                    -webkit-user-drag: none;
                    height: 100%;
                    user-select: none;
				}
                #background {
                    position:absolute;
                    transform:translate(-50%, -50%);
                    z-index: -100;
                    user-select: none;
                    -webkit-user-drag: none;
                }
                #playerHpBar {
                    -webkit-user-drag: none;
                    margin-left: 5px;
                    margin-top:5px;
                    width:300px;
                    height:15px;
                    z-index: 100;
                    user-select: none;
                    background-color: rgb(27, 27, 27);
                }
            </style>
        </head>
        <body>
            <div id = "torso"></div>
            <div id = "background"></div>
            <div id = "head"></div>
            <div id = "weapon"></div>
            <div id = "playerHpBar"></div>
            <script>
                const screenWidth = window.screen.width;
                const screenHeight = window.screen.height;
                var mouseX = 0;
                var mouseY = 0;
                var angle = 0;
                var degrees = 0;
                var xvel = 0;
                var yvel = 0;
                var upPressed = false;
				var leftPressed = false;
				var downPressed = false;
				var rightPressed = false;
				var spacePressed = false;
				var ePressed = false;
                var shiftPressed = false;
                var dodgeCooldown = 0;
                var iframes = 0;
                var swinging = false;
                var swingTime = 0;
                var swingVel = 0;
                var swingCurrentAngle = 0;
                var combo = 1;
                var mouseDown = false;
                var attackCharge = 0;
                var weaponBaseSize = 1;
                var currParticleImage = "";
                var AR = 100;
                var weaponAngle = 0;
                var playerHealth = 500;
                var currProjectileImage = "";
                var random = 0;
                var barrageTime = 0;
                var barrageCooldown = 0;
                document.addEventListener('keydown', (event) => {
  				if (event.key === 'w' || event.key === 'W') {
     				   upPressed = true;
   				 } else if (event.key === 's' || event.key === 'S') {
     				   downPressed = true;
   				 } else if (event.key === 'a' || event.key === 'A') {
     				   leftPressed = true;
  				 } else if (event.key === 'd' || event.key === 'D') {
   				     rightPressed = true;
   				 } else if (event.key === ' ') {
   				     spacePressed = true;
   				 } else if (event.key === 'e' || event.key === 'E') {
   				     ePressed = true;
   				 }
                if (event.shiftKey) {
                    shiftPressed = true;
                }
				});
				document.addEventListener('keyup', (event) => {
  				if (event.key === 'w' || event.key === 'W') {
     				   upPressed = false;
   				 } else if (event.key === 's' || event.key === 'S') {
     				   downPressed = false;
   				 } else if (event.key === 'a' || event.key === 'A') {
     				   leftPressed = false;
  				 } else if (event.key === 'd' || event.key === 'D') {
   				     rightPressed = false;
   				 } else if (event.key === ' ') {
   				     spacePressed = false;
   				 } else if (event.key === 'e' || event.key === 'E') {
   				     ePressed = false;
   				 }
                if (event.shiftKey) {
                    shiftPressed = false;
                }
                });
                addEventListener("mousemove", e => {
                    mouseX = e.pageX - window.screen.width*0.5;
                    mouseY = e.pageY - window.screen.height*0.5 + 42;
                    angle = Math.atan2(mouseY, mouseX)
                    degrees = angle * 180/ Math.PI
                });
                addEventListener('mousedown', function(event) {
                    if (event.button === 0 && swingTime <= 0) {
                        mouseDown = true;
                    } 
                });
                addEventListener('mouseup', function(event) {
                    if (event.button === 0 && swingTime <= 0) {
                        mouseDown = false;
                        currParticleImage = "slash.gif";
                        Particle(window.screen.width*0.5 + 5*random - (attackCharge/400 + 1)*20*Math.cos(angle), window.screen.height*0.5 + 5*random - (attackCharge/400 + 1)*20*Math.sin(angle), (degrees + 5*random), 120*(attackCharge/400 + 1)*(1 + Math.random())*0.5, 250*(attackCharge/400 + 1), 350, 0, 0.5*Math.cos(angle), 0.5*Math.sin(angle), 0);
                        swingTime = 75;
                        xvel += (attackCharge/400 + 1)*6*Math.cos(angle);
                        yvel += (attackCharge/400 + 1)*6*Math.sin(angle);
                        swingCurrentAngle = angle;
                        swingVel = 0;
                    }
                });
                document.addEventListener('contextmenu', function(event) {
                    event.preventDefault();
                });
                function spawnClouds() {
    				var cloudSize = Math.random();
   				    var cloudElement = document.createElement("div");
    				var cloudElement2 = document.createElement("div");
    				cloudElement.classList.add('cloud');
    				cloudElement.creationTime = Date.now();
    				cloudElement.angle = degrees * Math.PI / 180 + 0.5 * (Math.random() - Math.random());
				    cloudElement.speed = -1.5 * Math.random() - 0.5;
    				document.body.appendChild(cloudElement);
    				cloudElement.innerHTML = "<img src=\'cloud.gif\' width=\'64px\' height=\'64px\'>";
   				    cloudElement.style.position = "absolute";
    				cloudElement.style.top = window.screen.height*0.5 - 25 + 30*Math.random() - 50*Math.random() + "px";
   				    cloudElement.style.left = window.screen.width*0.5 - 25 + 30*Math.random() - 30*Math.random() + "px";
				    cloudElement.x = parseFloat(cloudElement.style.left);
				    cloudElement.y = parseFloat(cloudElement.style.top);
        			cloudElement.style.transform = "rotate(" + (360 * Math.random()) + "deg) scale(" + cloudSize + "," + cloudSize + ")";
				}
                function manageClouds() {
    						var clouds = document.getElementsByClassName("cloud");
    						const cloud_LIFETIME = 200;
    						const time = Date.now();
    						for (const cloud of clouds) {
        					const sinceCreation = time - cloud.creationTime;
        					if (sinceCreation > cloud_LIFETIME) {
            						cloud.remove();
        					} else {
							cloud.x = parseFloat(cloud.style.left);
							cloud.y = parseFloat(cloud.style.top);
            					cloud.style.opacity = (cloud_LIFETIME - sinceCreation) / cloud_LIFETIME;
            					cloud.style.left = parseFloat(cloud.style.left) + cloud.speed * (Math.cos(cloud.angle)) / (1 - sinceCreation / 200) + "px";
            					cloud.style.top = parseFloat(cloud.style.top) + cloud.speed * (Math.sin(cloud.angle)) / (1 - sinceCreation / 200) + "px";
                                cloud.style.left = (parseFloat(cloud.style.left) - xvel) + "px";
                                cloud.style.top = (parseFloat(cloud.style.top) - yvel) + "px";
        					}
    					}
				}
                function Particle(x,y,angle,height,width,duration, separate, hvel, vvel, fade) {
                    var particleElement = document.createElement("div");
                    particleElement.classList.add('particle');
                    particleElement.creationTime = Date.now();
                    particleElement.duration = duration;
                    particleElement.angle = angle;
                    document.body.appendChild(particleElement);
                    particleElement.innerHTML = "<img src=\'" + currParticleImage + "?t=" + Date.now() + "\'width=\'" + width +"px\' height=\'"+ height + "px\'>";
                    particleElement.style.position = "absolute";
                    particleElement.style.top = y + "px";
                    particleElement.style.left = x + "px";
                    particleElement.style.transform = " translate(-50%, -50%) rotate(" + angle + "deg)";
                    particleElement.separate = separate;
                    particleElement.style.zIndex = -3;
                    particleElement.hvel = hvel;
                    particleElement.vvel = vvel;
                    particleElement.width = width;
                    particleElement.height = height;
                    particleElement.fade = fade;
                    particleElement.ogimage = currParticleImage;
                }
                function manageParticles() {
                        var particles = document.getElementsByClassName("particle");
                        const time = Date.now();
                        for (const particle of particles) {
                            const sinceCreation = time - particle.creationTime;
                            particle.style.left = (parseFloat(particle.style.left) + particle.hvel) + "px";
                            particle.style.top = (parseFloat(particle.style.top) + particle.vvel) + "px";
                            if (sinceCreation > particle.duration) {
                                particle.remove();
                            } else {
                                if (particle.fade == 1) {
                                    particle.style.opacity = (particle.duration - sinceCreation)/particle.duration;
                                }
                                if (particle.separate == 1) {
                                    particle.style.left = (parseFloat(particle.style.left) - xvel) + "px";
                                    particle.style.top = (parseFloat(particle.style.top) - yvel) + "px";
                                }
                            }
                        }
                }
                function Projectile(x,y,radius,duration, homing, hvel, vvel, fade, damage, destroy, slow, turn) {
                    var projectileElement = document.createElement("div");
                    projectileElement.classList.add('projectile');
                    projectileElement.creationTime = Date.now();
                    projectileElement.duration = duration;
                    document.body.appendChild(projectileElement);
                    projectileElement.innerHTML = "<img src=\'" + currProjectileImage + "\' width=\'" + 2*radius +"px\' height=\'"+ 2*radius + "px\'>";
                    projectileElement.style.position = "absolute";
                    projectileElement.style.top = y + "px";
                    projectileElement.style.left = x + "px";
                    projectileElement.style.transform = " translate(-50%, -50%) rotate(" + 0 + "deg)";
                    projectileElement.style.zIndex = -1;
                    projectileElement.hvel = hvel;
                    projectileElement.vvel = vvel;
                    projectileElement.homing = homing;
                    projectileElement.fade = fade;
                    projectileElement.damage = damage;
                    projectileElement.destroy = destroy;
                    projectileElement.radius = radius;
                    projectileElement.canHit = true;
                    projectileElement.slow = slow;
                    projectileElement.turn = turn;
                }
                function manageProjectiles() {
                        var projectiles = document.getElementsByClassName("projectile");
                        const time = Date.now();
                        for (const projectile of projectiles) {
                            var projAngle = Math.atan2((0.5*window.screen.height - parseFloat(projectile.style.top)) , (0.5*window.screen.width - parseFloat(projectile.style.left)));
                            const sinceCreation = time - projectile.creationTime;
                            projectile.style.left = (parseFloat(projectile.style.left) + projectile.hvel) + "px";
                            projectile.style.top = (parseFloat(projectile.style.top) + projectile.vvel) + "px";
                            if (sinceCreation > projectile.duration) {
                                projectile.remove();
                            } else {
                                projectile.hvel += (projectile.homing)*Math.cos(projAngle);
                                projectile.vvel += (projectile.homing)*Math.sin(projAngle);
                                if (projectile.turn == true) {
                                    projectile.style.transform = " translate(-50%, -50%) rotate(" + (360*Math.random()) + "deg)";
                                } else {
                                    projectile.style.transform = " translate(-50%, -50%) rotate(" + (180*Math.atan2(projectile.vvel, projectile.hvel)/Math.PI) + "deg)";
                                }
                                if (Math.sqrt((0.5*window.screen.width - parseFloat(projectile.style.left))*(0.5*window.screen.width - parseFloat(projectile.style.left)) + (0.5*window.screen.height - parseFloat(projectile.style.top))*(0.5*window.screen.height - parseFloat(projectile.style.top))) <= (20 + projectile.radius) && iframes <= 0) {
                                    if (swingTime <= 0 && projectile.canHit == true) {
                                        playerHealth -= projectile.damage;
                                        iframes = 100;
                                        if (projectile.destroy == true) {
                                            projectile.canHit = false;
                                            projectile.remove();
                                            continue;
                                        }
                                    }
                                }
                                if (projectile.fade == true) {
                                    projectile.style.opacity = (projectile.duration - sinceCreation)/projectile.duration;
                                }
                                    projectile.style.left = (parseFloat(projectile.style.left) - xvel) + "px";
                                    projectile.style.top = (parseFloat(projectile.style.top) - yvel) + "px";
                            }
                            projectile.hvel *= projectile.slow;
                            projectile.vvel *= projectile.slow;
                        }
                }
                function Wisp(baseCooldown) {
                    var wispElement = document.createElement("div");
                    var initAngle = 360*Math.random();
                    wispElement.classList.add('wisp');
                    wispElement.creationTime = Date.now();
                    document.body.appendChild(wispElement);
                    wispElement.innerHTML = "<img src=\'wisp.gif\' width=\'" + 64 + "px\' height=\'"+ 64 + "px\'>";
                    wispElement.style.position = "absolute";
                    wispElement.style.userSelect = 'none';
                    wispElement.y = 0.5*window.screen.height + 2500*Math.sin(initAngle);
                    wispElement.x = 0.5*window.screen.width + 2500*Math.cos(initAngle);
                    wispElement.xvel = 0;
                    wispElement.yvel = 0;
                    wispElement.style.transform = " translate(-50%, -50%) rotate(0deg)";
                    wispElement.style.opacity = 1;
                    wispElement.health = 100;
                    wispElement.style.transformOrigin = "center center";
                    wispElement.watchDistance = 400 + 200*(Math.random() - Math.random());
                    wispElement.meleeVul = true;
                    wispElement.shotCooldown = baseCooldown;
                    wispElement.baseCooldown = baseCooldown;
                }
                function manageWisps() {
                        var wisps = document.getElementsByClassName("wisp");
                        var swordXOverlap = false;
                        var swordYOverlap = false;
                            for (const wisp of wisps) {
                                var wispAngle = Math.atan2((0.5*window.screen.height - wisp.y) , (0.5*window.screen.width - wisp.x));
                                wisp.shotCooldown -= 1;
                                if (wisp.shotCooldown <= 0) {
                                    wisp.shotCooldown = wisp.baseCooldown;
                                    currProjectileImage = "lightbolt.png";
                                    Projectile(wisp.x, wisp.y, 32, 1000, 0.02, 5*Math.cos(wispAngle + 0.1*(Math.random() - Math.random())), 5*Math.sin(wispAngle + 0.1*(Math.random() - Math.random())), true, 25, true, 1, false);
                                }
                                if (swingTime <= 0) {
                                    wisp.meleeVul = true;
                                }
                                const relX = wisp.x - 0.5*window.screen.width;
                                const relY = wisp.y - 0.5*window.screen.height;
                                var rotatedX = (relX)*Math.cos(-1*angle) - (relY)*Math.sin(-1*angle);
                                var rotatedY = (relX)*Math.sin(-1*angle) + (relY)*Math.cos(-1*angle);
                                    if ((-16*(1 + (attackCharge/400)) - 32) <= rotatedX && rotatedX <= (100*(1 + (attackCharge/400)) + 32)) {
                                        swordXOverlap = true;
                                    } else {
                                        swordXOverlap = false;
                                    }
                                    if ((-50*(1 + (attackCharge/400)) - 32) <= rotatedY && rotatedY <= (50*(1 + (attackCharge/400)) + 32)) {
                                        swordYOverlap = true;
                                    } else {
                                        swordYOverlap = false;
                                    }
                                if (wisp.meleeVul == true && swordXOverlap == true && swingTime > 0 && swordYOverlap == true) {
                                    wisp.health -= AR*(1 + (attackCharge/400));
                                    currParticleImage = "cloud.gif";
                                    Particle(wisp.x + 16*(Math.random() - Math.random()), wisp.y + 16*(Math.random() - Math.random()), 360*Math.random(), 32, 32, 1000, 1, 1*(Math.random() - Math.random()), 1*(Math.random() - Math.random()), 1);
                                    wisp.xvel += (1 + (attackCharge/400))*AR*0.1*Math.cos(angle);
                                    wisp.yvel += (1 + (attackCharge/400))*AR*0.1*Math.sin(angle);
                                    wisp.meleeVul = false;
                                }
                                if (Math.sqrt((0.5*window.screen.width - parseFloat(wisp.style.left))*(0.5*window.screen.width - parseFloat(wisp.style.left)) + (0.5*window.screen.height - parseFloat(wisp.style.top))*(0.5*window.screen.height - parseFloat(wisp.style.top))) <= (200 - 0.5*barrageTime) && barrageTime >= 0) {
                                    currParticleImage = "cloud.gif";
                                    wisp.health -= 10;
                                    Particle(wisp.x + 16*(Math.random() - Math.random()), wisp.y + 16*(Math.random() - Math.random()), 360*Math.random(), 32, 32, 1000, 1, 1*(Math.random() - Math.random()), 1*(Math.random() - Math.random()), 1);
                                    wisp.xvel -= (0.1*Math.cos(wispAngle));
                                    wisp.yvel -= (0.1*Math.sin(wispAngle));
                                }
                            if (wisp.health <= 0) {
                                for(i = 0; i < 3; i++) {
                                    currParticleImage = "cloud.gif";
                                    Particle(wisp.x + 16*(Math.random() - Math.random()), wisp.y + 16*(Math.random() - Math.random()), 360*Math.random(), 64, 64, 1000, 1, 0.5*(Math.random() - Math.random()), 0.5*(Math.random() - Math.random()), 1);
                                }
                                wisp.remove();
                            } else {
                                wisp.style.left = wisp.x + "px";
                                wisp.style.top = wisp.y + "px"
                                wisp.style.transform = "translate(-50%, -50%) rotate(" + (180*wispAngle)/(Math.PI) +"deg)";
                                wisp.x -= xvel;
                                wisp.y -= yvel;
                                if (Math.sqrt(((0.5*window.screen.height - wisp.y)*(0.5*window.screen.height - wisp.y))+((0.5*window.screen.width - wisp.x)*(0.5*window.screen.width - wisp.x))) >= wisp.watchDistance){
                                    wisp.xvel += 0.2*Math.cos(wispAngle);
                                    wisp.yvel += 0.2*Math.sin(wispAngle);
                                } else {
                                    wisp.xvel -= 0.1*Math.cos(wispAngle);
                                    wisp.yvel -= 0.1*Math.sin(wispAngle);
                                }
                                
                                wisp.xvel *= 0.92;
                                wisp.yvel *= 0.92;
                                wisp.x += wisp.xvel;
                                wisp.y += wisp.yvel;
                            }
                        }
                }

                function Runner(baseCooldown) {
                    var runnerElement = document.createElement("div");
                    var initAngle = 360*Math.random();
                    runnerElement.classList.add('runner');
                    runnerElement.creationTime = Date.now();
                    document.body.appendChild(runnerElement);
                    runnerElement.innerHTML = "<img src=\'runner.gif\' width=\'" + 100 + "px\' height=\'"+ 100 + "px\'>";
                    runnerElement.style.position = "absolute";
                    runnerElement.style.userSelect = 'none';
                    runnerElement.y = 0.5*window.screen.height + 2500*Math.sin(angle);
                    runnerElement.x = 0.5*window.screen.width + 2500*Math.cos(angle);
                    runnerElement.xvel = 0;
                    runnerElement.yvel = 0;
                    runnerElement.style.transform = " translate(-50%, -50%) rotate(0deg)";
                    runnerElement.style.opacity = 1;
                    runnerElement.health = 1000;
                    runnerElement.style.transformOrigin = "center center";
                    runnerElement.meleeVul = true;
                    runnerElement.meleeCooldown = baseCooldown;
                    runnerElement.baseCooldown = baseCooldown;
                    runnerElement.meleeTime = 100;
                    runnerElement.strafeSpeed = 0.02*(Math.random() - Math.random());
                }
                function manageRunners() {
                        var runners = document.getElementsByClassName("runner");
                        var swordXOverlap = false;
                        var swordYOverlap = false;
                            for (const runner of runners) {
                                var runnerAngle = Math.atan2((0.5*window.screen.height - runner.y) , (0.5*window.screen.width - runner.x));
                                runner.meleeCooldown -= 1;
                                if (runner.meleeCooldown <= 0 && Math.sqrt(((0.5*window.screen.height - runner.y)*(0.5*window.screen.height - runner.y))+((0.5*window.screen.width - runner.x)*(0.5*window.screen.width - runner.x))) <= 150) {
                                    runner.meleeTime = 100;
                                    runner.meleeCooldown = runner.baseCooldown;
                                    runner.xvel += 5*Math.cos(runnerAngle);
                                    runner.yvel += 5*Math.sin(runnerAngle);
                                }
                                if (runner.meleeTime > -10) {
                                    runner.xvel *= 0.98;
                                    runner.yvel *= 0.98;
                                }
                                if (runner.meleeTime == 50) {
                                    runner.innerHTML = "<img src=\'runnerAttack.gif\' width=\'" + 100 + "px\' height=\'"+ 100 + "px\'>";
                                }
                                if (runner.meleeTime == 1) {
                                    runner.innerHTML = "<img src=\'runner.gif\' width=\'" + 100 + "px\' height=\'"+ 100 + "px\'>";
                                    currParticleImage = "slash.gif";
                                    Particle(runner.x + 10*Math.random(),runner.y + 10*Math.random(),180*runnerAngle/Math.PI,200,300,300, 1, 1.5*Math.cos(runnerAngle), 1.5*Math.sin(runnerAngle), 1);
                                    if (Math.sqrt(((0.5*window.screen.height - (runner.y + 75*Math.sin(runnerAngle)))*(0.5*window.screen.height - (runner.y + 75*Math.sin(runnerAngle))))+((0.5*window.screen.width - (runner.x + 75*Math.cos(runnerAngle)))*(0.5*window.screen.width - (runner.x + 75*Math.cos(runnerAngle))))) <= 75 && iframes <= 0) {
                                        playerHealth -= 50;
                                        iframes = 100;
                                    }

                                }
                                if (swingTime <= 0) {
                                    runner.meleeVul = true;
                                }
                                runner.meleeTime -= 1;
                                const relX = runner.x - 0.5*window.screen.width;
                                const relY = runner.y - 0.5*window.screen.height;
                                var rotatedX = (relX)*Math.cos(-1*angle) - (relY)*Math.sin(-1*angle);
                                var rotatedY = (relX)*Math.sin(-1*angle) + (relY)*Math.cos(-1*angle);
                                    if ((-16*(1 + (attackCharge/400)) - 32) <= rotatedX && rotatedX <= (100*(1 + (attackCharge/400)) + 32)) {
                                        swordXOverlap = true;
                                    } else {
                                        swordXOverlap = false;
                                    }
                                    if ((-50*(1 + (attackCharge/400)) - 32) <= rotatedY && rotatedY <= (50*(1 + (attackCharge/400)) + 32)) {
                                        swordYOverlap = true;
                                    } else {
                                        swordYOverlap = false;
                                    }
                                if (runner.meleeVul == true && swordXOverlap == true && swingTime > 0 && swordYOverlap == true) {
                                    runner.health -= AR*(1 + (attackCharge/400));
                                    currParticleImage = "cloud.gif";
                                    Particle(runner.x + 16*(Math.random() - Math.random()), runner.y + 16*(Math.random() - Math.random()), 360*Math.random(), 32, 32, 1000, 1, 1*(Math.random() - Math.random()), 1*(Math.random() - Math.random()), 1);
                                    runner.xvel += (1 + (attackCharge/400))*AR*0.1*Math.cos(angle);
                                    runner.yvel += (1 + (attackCharge/400))*AR*0.1*Math.sin(angle);
                                    runner.meleeVul = false;
                                }
                                if (Math.sqrt((0.5*window.screen.width - parseFloat(runner.style.left))*(0.5*window.screen.width - parseFloat(runner.style.left)) + (0.5*window.screen.height - parseFloat(runner.style.top))*(0.5*window.screen.height - parseFloat(runner.style.top))) <= (200 - 0.5*barrageTime) && barrageTime >= 0) {
                                    currParticleImage = "cloud.gif";
                                    runner.health -= 10;
                                    Particle(runner.x + 16*(Math.random() - Math.random()), runner.y + 16*(Math.random() - Math.random()), 360*Math.random(), 32, 32, 1000, 1, 1*(Math.random() - Math.random()), 1*(Math.random() - Math.random()), 1);
                                    runner.xvel -= (0.1*Math.cos(runnerAngle));
                                    runner.yvel -= (0.1*Math.sin(runnerAngle));
                                }
                            if (runner.health <= 0) {
                                for(i = 0; i < 3; i++) {
                                    currParticleImage = "cloud.gif";
                                    Particle(runner.x + 16*(Math.random() - Math.random()), runner.y + 16*(Math.random() - Math.random()), 360*Math.random(), 64, 64, 1000, 1, 0.5*(Math.random() - Math.random()), 0.5*(Math.random() - Math.random()), 1);
                                }
                                runner.remove();
                            } else {
                                runner.style.left = runner.x + "px";
                                runner.style.top = runner.y + "px"
                                if (runnerAngle*180/Math.PI < 90 && runnerAngle*180/Math.PI > -90) {
                                    runner.style.transform = "translate(-50%, -50%) scaleX(1)";
                                } else {
                                    runner.style.transform = "translate(-50%, -50%) scaleX(-1)";
                                }
                                runner.x -= xvel;
                                runner.y -= yvel;
                                if (Math.sqrt(((0.5*window.screen.height - runner.y)*(0.5*window.screen.height - runner.y))+((0.5*window.screen.width - runner.x)*(0.5*window.screen.width - runner.x))) >= 100){
                                    runner.xvel += 0.05*Math.cos(runnerAngle);
                                    runner.yvel += 0.05*Math.sin(runnerAngle);
                                    runner.xvel += runner.strafeSpeed*Math.cos(runnerAngle + Math.PI/2);
                                    runner.yvel += runner.strafeSpeed*Math.sin(runnerAngle + Math.PI/2);
                                } else {
                                    runner.xvel -= 0.01*Math.cos(runnerAngle);
                                    runner.yvel -= 0.01*Math.sin(runnerAngle);
                                }
                                
                                runner.xvel *= 0.98;
                                runner.yvel *= 0.98;
                                runner.x += runner.xvel;
                                runner.y += runner.yvel;
                            }
                        }
                }


                const torsoElement = document.getElementById('torso');
                torsoElement.style.top = window.screen.height*0.5 + "px";
				torsoElement.style.left = window.screen.width*0.5 + "px";
				torsoElement.innerHTML = "<img src=\'torso.gif\' width=\'50px\' height=\'50px\'>";
                const headElement = document.getElementById('head');
                headElement.style.top = window.screen.height*0.5 + "px";
				headElement.style.left = window.screen.width*0.5 + "px";
				headElement.innerHTML = "<img src=\'head.gif\' width=\'30px\' height=\'30px\'>";
                const bgElement = document.getElementById('background');
                bgElement.style.top = window.screen.height*0.5 + "px";
				bgElement.style.left = window.screen.width*0.5 + "px";
                bgElement.innerHTML = "<img src=\'arena.gif\' width=\'5000px\' height=\'5000px\' draggable='false'>";
                const playerHpElement = document.getElementById('playerHpBar');
                function handleTick(){
                    if (ePressed == true && barrageCooldown <= 0 && barrageTime <= 0) {
                        barrageTime = 100;
                        barrageCooldown = 200;
                    }
                    if (barrageTime > 0) {
                        currParticleImage = "slash.png";
                        for (i = 0; i < 3; i++){
                            xvel += 0.03*Math.cos(angle);
                            yvel += 0.03*Math.sin(angle);
                            random = Math.random() - Math.random();
                            Particle(window.screen.width*0.5 + 5*random - 20*Math.cos(360*random*angle), window.screen.height*0.5 + 5*random - 20*Math.sin(360*random*angle), (360*random*degrees + 5*random), 200*Math.random(), 400 - barrageTime, 90, 0, 1*Math.cos(360*random*angle), 1*Math.sin(360*random*angle), 1);
                        }
                    }
                    playerHpElement.style.width = playerHealth + "px";
                    if (playerHealth > 500){
                        playerHealth = 500;
                    }
                    weaponAngle = (Math.PI)*((swingCurrentAngle*180/Math.PI) - combo*60 + 90*(combo-1))/180;
                    if (mouseDown && swingTime <= 0) {
                            attackCharge += 1;
                    }

                    if (leftPressed == true) {
                        xvel -= 0.1;
                    } 
                    if (rightPressed == true){
                        xvel += 0.1;
                    }
                    if (upPressed == true) {
                        yvel -= 0.1;
                    }
                    if (downPressed == true) {
                        yvel += 0.1;
                    }
                    if (spacePressed == true && dodgeCooldown <= 0) {
                        dodgeCooldown = 100;
                        iframes = 50;
                        xvel += 12*Math.cos(angle);
                        yvel += 12*Math.sin(angle);
                    }
                    if (degrees <= 90 && degrees >= -90) {
                        torsoElement.style.transform = "scaleX(1) translate(-50%, -50%)";
                        headElement.style.transform = "translate(-50%, -140%) rotate(" + degrees + "deg)";
                    } else {
                        torsoElement.style.transform = "scaleX(-1) translate(50%, -50%)";
                        headElement.style.transform = "translate(-50%, -140%) rotate(" + degrees + "deg)";
                    }
                    yvel *= 0.96;
                    xvel *= 0.96;
                    bgElement.style.left = (parseFloat(bgElement.style.left) - xvel) + "px";
                    bgElement.style.top = (parseFloat(bgElement.style.top) - yvel) + "px";
                    iframes -= 1;
                    dodgeCooldown -= 1;
                    if (iframes > 0) {
                        torsoElement.style.opacity = 0.1;
                        headElement.style.opacity = 0.1;
                            spawnClouds();
                    } else {
                        torsoElement.style.opacity = 1;
                        headElement.style.opacity = 1;
                    }
                    manageClouds();
                    manageParticles();
                    manageWisps();
                    manageProjectiles();
                    manageRunners();
                    if (swingTime == 1) {
                        attackCharge = 0;
                    }
                    barrageTime -= 1;
                    if (barrageTime <= 0) {
                        barrageCooldown -= 1;
                    }
                    if (swingTime <= 0 && mouseDown && attackCharge >= 50) {
                        currParticleImage = "chargeparticle.png"
                        Particle(screenWidth*0.5 + (attackCharge/1600 + 1)*30*random, screenHeight*0.5 + (attackCharge/1600 + 1)*10*(Math.random() - Math.random()) + 20, 0, 10*(attackCharge/400 + 1), 1, 100, 0, 0, -1*(attackCharge/400 + 1), 1);
                    }
                    swingTime -= 1;
                    random = Math.random() - Math.random();
                }
                let intervalId = setInterval(() => handleTick(), 1);
                for(i = 0; i < 1; i++){
                    Runner(150 + 100*Math.random());
                    Wisp(250 + 100*Math.random())
                }
            </script>
        </body>
    </html>