<!DOCTYPE html>
    <html>
        <head>
            <style>
                #torso {
                    position:absolute;
                    user-select: none;
                    transform: translate(-50%, -50%);
                    z-index: -5;
                }
                #head {
                    position:absolute;
                    user-select: none;
                    transform: translate(-50%, -130%);
                    z-index: -3;
                    transform-origin: center 45%;
                }
                #weapon {
                    position: absolute;
                    user-select: none;
                    transform: translate(-50%, -50%);
                    z-index: -4;
                }
                body {
				    overflow: hidden;
                    height: 100%;
				}
                #background {
                    position:absolute;
                    transform:translate(-50%, -50%);
                    z-index: -100;
                }
            </style>
        </head>
        <body>
            <div id = "torso"></div>
            <div id = "background"></div>
            <div id = "head"></div>
            <div id = "weapon"></div>
            <script>
                const screenWidth = window.screen.width;
                const screenHeight = window.screen.height;
                var mouseX = 0;
                var mouseY = 0;
                var angle = 0;
                var degrees = 0;
                var xvel = 0;
                var yvel = 0;
                var upPressed = false;
				var leftPressed = false;
				var downPressed = false;
				var rightPressed = false;
				var spacePressed = false;
				var ePressed = false;
                var shiftPressed = false;
                var dodgeCooldown = 0;
                var iframes = 0;
                var swinging = false;
                var swingTime = 0;
                var swingVel = 0;
                var swingCurrentAngle = 0;
                var combo = 1;
                var mouseDown = false;
                var attackCharge = 0;
                var heavyTime = 0;
                document.addEventListener('keydown', (event) => {
  				if (event.key === 'w') {
     				   upPressed = true;
   				 } else if (event.key === 's') {
     				   downPressed = true;
   				 } else if (event.key === 'a') {
     				   leftPressed = true;
  				 } else if (event.key === 'd') {
   				     rightPressed = true;
   				 } else if (event.key === ' ') {
   				     spacePressed = true;
   				 } else if (event.key === 'e') {
   				     ePressed = true;
   				 }
                if (event.shiftKey) {
                    shiftPressed = true;
                }
				});
				document.addEventListener('keyup', (event) => {
  				if (event.key === 'w') {
     				   upPressed = false;
   				 } else if (event.key === 's') {
     				   downPressed = false;
   				 } else if (event.key === 'a') {
     				   leftPressed = false;
  				 } else if (event.key === 'd') {
   				     rightPressed = false;
   				 } else if (event.key === ' ') {
   				     spacePressed = false;
   				 } else if (event.key === 'e') {
   				     ePressed = false;
   				 }
                if (event.shiftKey) {
                    shiftPressed = false;
                }
                });
                addEventListener("mousemove", e => {
                    mouseX = e.pageX - window.screen.width*0.5;
                    mouseY = e.pageY - window.screen.height*0.5 + 42;
                    angle = Math.atan2(mouseY, mouseX)
                    degrees = angle * 180/ Math.PI
                });
                addEventListener('mousedown', function(event) {
                    if (event.button === 0 && swingTime <= 0) {
                        mouseDown = true;
                    } 
                });
                addEventListener('mouseup', function(event) {
                    if (event.button === 0 && swingTime <= 0 && heavyTime <= 0) {
                        mouseDown = false;
                        if (shiftPressed = true && attackCharge >= 300) {
                            if (attackCharge >= 900) {
                                heavyTime = 360;
                            }
                        } else {
                            swingTime = 150;
                        }
                    }
                });
                function spawnClouds() {
    				var cloudSize = Math.random();
   				    var cloudElement = document.createElement("div");
    				var cloudElement2 = document.createElement("div");
    				cloudElement.classList.add('cloud');
    				cloudElement.creationTime = Date.now();
    				cloudElement.angle = degrees * Math.PI / 180 + 0.5 * (Math.random() - Math.random());
				    cloudElement.speed = -1.5 * Math.random() - 0.5;
    				document.body.appendChild(cloudElement);
    				cloudElement.innerHTML = "<img src=\'cloud.gif\' width=\'64px\' height=\'64px\'>";
   				    cloudElement.style.position = "absolute";
    				cloudElement.style.top = window.screen.height*0.5 - 25 + 30*Math.random() - 50*Math.random() + "px";
   				    cloudElement.style.left = window.screen.width*0.5 - 25 + 30*Math.random() - 30*Math.random() + "px";
				    cloudElement.x = parseFloat(cloudElement.style.left);
				    cloudElement.y = parseFloat(cloudElement.style.top);
        			cloudElement.style.transform = "rotate(" + (360 * Math.random()) + "deg) scale(" + cloudSize + "," + cloudSize + ")";
				}
                function manageClouds() {
    						var clouds = document.getElementsByClassName("cloud");
    						const cloud_LIFETIME = 200;
    						const time = Date.now();
    						for (const cloud of clouds) {
        					const sinceCreation = time - cloud.creationTime;
        					if (sinceCreation > cloud_LIFETIME) {
            						cloud.remove();
        					} else {
							cloud.x = parseFloat(cloud.style.left);
							cloud.y = parseFloat(cloud.style.top);
            						cloud.style.opacity = (cloud_LIFETIME - sinceCreation) / cloud_LIFETIME;
            						cloud.style.left = parseFloat(cloud.style.left) + cloud.speed * (Math.cos(cloud.angle)) / (1 - sinceCreation / 200) + "px";
            						cloud.style.top = parseFloat(cloud.style.top) + cloud.speed * (Math.sin(cloud.angle)) / (1 - sinceCreation / 200) + "px";
                                    cloud.style.left = (parseFloat(cloud.style.left) - xvel) + "px";
                                    cloud.style.top = (parseFloat(cloud.style.top) - yvel) + "px";
        					}
    					}
				}
                const torsoElement = document.getElementById('torso');
                torsoElement.style.top = window.screen.height*0.5 + "px";
				torsoElement.style.left = window.screen.width*0.5 + "px";
				torsoElement.innerHTML = "<img src=\'torso.gif\' width=\'50px\' height=\'50px\'>";
                const headElement = document.getElementById('head');
                headElement.style.top = window.screen.height*0.5 + "px";
				headElement.style.left = window.screen.width*0.5 + "px";
				headElement.innerHTML = "<img src=\'head.gif\' width=\'30px\' height=\'30px\'>";
                const bgElement = document.getElementById('background');
                bgElement.style.top = window.screen.height*0.5 + "px";
				bgElement.style.left = window.screen.width*0.5 + "px";
                bgElement.innerHTML = "<img src=\'lobby.png\' width=\'500px\' height=\'500px\'>";
                const wElement = document.getElementById('weapon');
                wElement.innerHTML = "<img src=\'black-splinter.png\' width=\'20px\' height=\'100px\'>";
                function handleTick(){
                    if (mouseDown && swingTime <= 0 && shiftPressed) {
                            attackCharge += 1;
                    }

                    if (leftPressed == true) {
                        xvel -= 0.1;
                    } 
                    if (rightPressed == true){
                        xvel += 0.1;
                    }
                    if (upPressed == true) {
                        yvel -= 0.1;
                    }
                    if (downPressed == true) {
                        yvel += 0.1;
                    }
                    if (spacePressed == true && dodgeCooldown <= 0) {
                        dodgeCooldown = 100;
                        iframes = 40;
                        xvel += 8*Math.cos(angle);
                        yvel += 8*Math.sin(angle);
                    }
                    if (degrees <= 90 && degrees >= -90) {
                        torsoElement.style.transform = "scaleX(1) translate(-50%, -50%)";
                        headElement.style.transform = "translate(-50%, -140%) rotate(" + degrees + "deg)";
                    } else {
                        torsoElement.style.transform = "scaleX(-1) translate(50%, -50%)";
                        headElement.style.transform = "translate(-50%, -140%) rotate(" + degrees + "deg)";
                    }
                    yvel *= 0.95;
                    xvel *= 0.95;
                    bgElement.style.left = (parseFloat(bgElement.style.left) - xvel) + "px";
                    bgElement.style.top = (parseFloat(bgElement.style.top) - yvel) + "px";
                    iframes -= 1;
                    dodgeCooldown -= 1;
                    if (iframes > 0) {
                        torsoElement.style.opacity = 0.1;
                        headElement.style.opacity = 0.1;
                            spawnClouds();
                    } else {
                        torsoElement.style.opacity = 1;
                        headElement.style.opacity = 1;
                    }
                    console.log(attackCharge);
                    manageClouds();
                    if (swingTime <= 0 && heavyTime <= 0 && !mouseDown) {
                        wElement.style.opacity = 0;
                    }
                    if (combo == 1) {
                        wElement.innerHTML = "<img src=\'black-splinter.png\' width=\'20px\' height=\'100px\'>";
                    } else {
                        wElement.innerHTML = "<img src=\'black-splinter-flipped.png\' width=\'20px\' height=\'100px\'>";
                    }
                    if (swingTime <= 0 && heavyTime <= 0 && mouseDown) {
                        wElement.style.transform = "translate(-50%, -50%) rotate(" + (degrees - combo*60 + 90*(combo - 1)) + "deg)";
                        wElement.style.left = (window.screen.width*0.5 - 70*Math.cos(angle + combo*Math.PI/5)) + "px";
                        wElement.style.top = (window.screen.height*0.5 - 70*Math.sin(angle + combo*Math.PI/5)) + "px";
                        swingCurrentAngle = angle;
                        swingVel = 0;
                        wElement.style.opacity = 0.1;
                    } else if(swingTime > 0){
                        attackCharge = 0;
                        swingCurrentAngle += swingVel;
                        wElement.style.transform = "translate(-50%, -50%) rotate(" + ((swingCurrentAngle*180/Math.PI) - combo*60 + 90*(combo-1)) + "deg)";
                        wElement.style.left = (window.screen.width*0.5 - 70*Math.cos(swingCurrentAngle + combo*Math.PI/5)) + "px";
                        wElement.style.top = (window.screen.height*0.5 - 70*Math.sin(swingCurrentAngle + combo*Math.PI/5)) + "px";
                        if (swingTime > 74) {
                            wElement.style.opacity = (parseFloat(wElement.style.opacity) + 0.015);
                            swingVel += combo*0.00085;
                        } else {
                            swingVel -= combo*0.00085;
                            wElement.style.opacity = (parseFloat(wElement.style.opacity) - 0.015);
                        }
                        if (swingTime == 1) {
                            combo *= -1;
                        }
                        swingTime -= 1;
                    } else if (heavyTime >= 0) {
                        console.log(heavyTime);
                        attackCharge = 0;
                        swingCurrentAngle += swingVel;
                        wElement.style.transform = "translate(-50%, -50%) rotate(" + ((swingCurrentAngle*180/Math.PI) - combo*60 + 90*(combo-1)) + "deg)";
                        wElement.style.left = (window.screen.width*0.5 - 70*Math.cos(swingCurrentAngle + combo*Math.PI/5)) + "px";
                        wElement.style.top = (window.screen.height*0.5 - 70*Math.sin(swingCurrentAngle + combo*Math.PI/5)) + "px";
                        heavyTime -= 1;
                        if (heavyTime == 1){
                            combo *= -1;
                        }
                        swingVel += combo*0.0004;
                        wElement.style.opacity = (parseFloat(wElement.style.opacity) + 0.002);
                    }
                }
                let intervalId = setInterval(() => handleTick(), 1);
            </script>
        </body>
    </html>